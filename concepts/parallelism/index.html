<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-20Z3J1CR22"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-20Z3J1CR22');
    </script>
    <link rel="index" title="Index" href="../../genindex/" /><link rel="search" title="Search" href="../../search/" /><link rel="next" title="Recursive Applications" href="../recursion/" /><link rel="prev" title="Additional Visibility" href="../additional-visibility/" />
        <link rel="canonical" href="https://burr.dagworks.io/concepts/parallelism/" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Parallelism - Burr</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=739e8c58" />
    <link rel="stylesheet" type="text/css" href="../../_static/testimonials.css?v=bd684830" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-announcement-background: #ffba00;
  --color-announcement-text: #091E42;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: #ffba00;
  --color-announcement-text: #091E42;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: #ffba00;
  --color-announcement-text: #091E42;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../"><div class="brand">Burr</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../">
  
  
  <span class="sidebar-brand-text">Burr</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Burr</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../getting_started/">Get started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Get started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/why-burr/">Why Burr?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/install/">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/simple-example/">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/up-next/">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples/">Cookbook</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Cookbook</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../examples/simple/">üß∏ Toy examples</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of üß∏ Toy examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/simple/counter/">Counter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/simple/cowsay/">Cowsay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/simple/choose-your-own-adventure/">Choose your own adventure</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../examples/chatbots/">üìû Chatbots</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of üìû Chatbots</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/chatbots/basic-chatbot/">Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/chatbots/gpt-like-chatbot/">GPT-like multimodal chatbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/chatbots/rag-chatbot-hamilton/">Conversational RAG with Burr and Hamilton</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../examples/agents/">ü§ñ Agents</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of ü§ñ Agents</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/agents/divide-and-conquer/">Divide and Conquer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/agents/agent-patterns/">Agent patterns</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../examples/deployment/">‚úà Deployment</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of ‚úà Deployment</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/deployment/web-server/">Burr in a web server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/deployment/infrastructure/">Provisioning Infrastructure/Deploying</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/deployment/monitoring/">Monitoring in Production</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../examples/guardrails/">üöß Guardrails / Tests</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of üöß Guardrails / Tests</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/guardrails/creating_tests/">Creating Test Cases</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../examples/data-science/">üß™ Data science</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of üß™ Data science</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/data-science/ml_training/">Hyperparameter tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/data-science/simulation/">Simulations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../">Concepts</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Concepts</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/">Cheat Sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sdlc/">SDLC with LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../actions/">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/">State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state-machine/">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transitions/">Transitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracking/">Tracking Burr</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state-persistence/">State Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serde/">Serialization / Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../streaming-actions/">Streaming Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state-typing/">Typing State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hooks/">Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../additional-visibility/">Additional Visibility</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../recursion/">Recursive Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planned-capabilities/">Planned Capabilities</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/application/">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/application/#graph-apis">Graph APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/actions/">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/state/">State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/serde/">Serialization &amp; Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/persister/">State Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/conditions/">Conditions/Transitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/tracking/">Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/visibility/">Tracing Inside Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle/">Lifecycle API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/parallelism/">Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/typing/">Typing</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/integrations/">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Integrations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/hamilton/">Hamilton</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/streamlit/">Streamlit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/opentelemetry/">OpenTelemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/traceloop/">Traceloop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/langchain/">Langchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/pydantic/">Pydantic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/haystack/">Haystack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/integrations/ray/">Ray</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/telemetry/">Usage analytics + data privacy</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../contributing/">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Contributing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/setup/">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/iterating/">Developing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/architecture/">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing/">Contributing</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Burr Cloud</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://forms.gle/w9u2QKcPrztApRedA">Waitist</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RESOURCES</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blog.dagworks.io/">Blog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/6Zy2DwP4f3">Discord community server</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dagworks-inc/burr">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twitter.com/dagworks">Twitter</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/dagworks-inc/burr/blob/main/docs/concepts/parallelism.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/dagworks-inc/burr/edit/main/docs/concepts/parallelism.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="parallelism">
<span id="id1"></span><h1>Parallelism<a class="headerlink" href="#parallelism" title="Link to this heading">¬∂</a></h1>
<p>Burr can run multiple actions in parallel. Each parallel branch can contain one or more actions, and different branches can have different actions. This is useful when:</p>
<ul class="simple">
<li><p>Trying different prompts with an LLM</p></li>
<li><p>Trying a prompt with different LLMs</p></li>
<li><p>Trying multiple prompts with multiple LLMs</p></li>
<li><p>Running multiple tools in parallel then combining/selecting from the result</p></li>
<li><p>Do semantic search and web search simultaneously for information retrieval</p></li>
</ul>
<p>And more! Just like Burr in general, these concepts are generic and can be applied to non-LLM applications
This section shows how to enable parallelism and presents use cases.</p>
<section id="tl-dr">
<h2>TL;DR<a class="headerlink" href="#tl-dr" title="Link to this heading">¬∂</a></h2>
<p>Burr provides a high-level and a low-level API for parallelism. The high-level API supports many different patterns and should be sufficient for most use cases.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MapStates</span></code>: Apply an action to multiple values in state then reduce the action results (e.g., different prompts to the same LLM).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapActions</span></code>: Apply different actions to the same state value then reduce the actions result (e.g., same prompt to different LLMs).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapActionsAndStates</span></code>: Do the full cartesian product of actions and state values (e.g., try different prompts with multiple LLMs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RunnableGraph</span></code>: Combined with the above options, you can replace a single Action by a Graph composed of multiple actions.</p></li>
</ul>
<p>With the low-level API, you can manually determine how parallel actions or subgraphs are executed.</p>
<img alt="../../_images/parallelism.png" class="align-center" src="../../_images/parallelism.png" />
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¬∂</a></h2>
<p>Burr allows you to define parallel actions by expanding a single action into multiple individual actions or subgraphs which
will execute them all and joining the results. This is a simple <a class="reference external" href="https://en.wikipedia.org/wiki/MapReduce">map-reduce</a> pattern.</p>
<p>Currently, Burr has two separate APIs for building parallel applications ‚Äì higher level (use this first), and lower level.
Beyond that, Burr can support parallelism however you wish to run it ‚Äì see the advanced use-cases section for more details.</p>
</section>
<section id="higher-level-api">
<h2>Higher-level API<a class="headerlink" href="#higher-level-api" title="Link to this heading">¬∂</a></h2>
<p>You select a set of ‚Äúconfigurations‚Äù over which you want to run, and Burr launches all of them then joins the result.</p>
<p>This means you either:</p>
<ol class="arabic simple">
<li><p>Vary the state and run over the same action/subgraph (think tuning LLM parameters/inputs, running simple experiments/optimization routines, etc‚Ä¶)</p></li>
<li><p>Vary the action and provide the same state (think running multiple LLMs on the same input, running multiple analyses on the same data, etc‚Ä¶)</p></li>
</ol>
<p>Note we do not distinguish between subgraph and action ‚Äì under the hood it‚Äôs all treated as a ‚Äúsub-application‚Äù (more on that later).</p>
<section id="run-the-same-action-over-different-states">
<h3>Run the same action over different states<a class="headerlink" href="#run-the-same-action-over-different-states" title="Link to this heading">¬∂</a></h3>
<p>For case (1) (mapping states over the same action) you implement the <code class="docutils literal notranslate"><span class="pre">MapStates</span></code> class, doing the following:</p>
<ul class="simple">
<li><p>We define a regular action <code class="docutils literal notranslate"><span class="pre">query_llm()</span></code> using the <code class="docutils literal notranslate"><span class="pre">&#64;action</span></code> decorator.</p></li>
<li><dl class="simple">
<dt>We also create a subclass of <code class="docutils literal notranslate"><span class="pre">MapStates</span></code> named <code class="docutils literal notranslate"><span class="pre">TestMultiplePrompts</span></code>, which must implement <code class="docutils literal notranslate"><span class="pre">.reads()</span></code>, <code class="docutils literal notranslate"><span class="pre">.writes()</span></code>, <code class="docutils literal notranslate"><span class="pre">.action()</span></code>, <code class="docutils literal notranslate"><span class="pre">.states()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.reduce()</span></code>.</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.reads()</span></code> / <code class="docutils literal notranslate"><span class="pre">.writes()</span></code> define the state value it can interact with, just like the <code class="docutils literal notranslate"><span class="pre">&#64;action</span></code> decorator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.action()</span></code> leverages the <code class="docutils literal notranslate"><span class="pre">query_llm()</span></code> previously defined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.states()</span></code> can read value from State and yields values to pass to the . action(). In this case, it updates the prompt state value that‚Äôs read by <code class="docutils literal notranslate"><span class="pre">query_llm()`</span></code>. (the example hardcoded a list of prompts for simplicity, but this would be read from state)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.reduce()</span></code> receives multiple states, one per <code class="docutils literal notranslate"><span class="pre">.action()</span></code> call, where the llm_output value is set by <code class="docutils literal notranslate"><span class="pre">query_llm()</span></code> in <code class="docutils literal notranslate"><span class="pre">.action()</span></code>. Then, it must set all_llm_output as specified in the <code class="docutils literal notranslate"><span class="pre">MapStates.writes()</span></code> method.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>We pass an instance of the <code class="docutils literal notranslate"><span class="pre">TestMultiplePrompts</span></code> class to the ApplicationBuilder, which will run the action over the states we provide.</p></li>
</ul>
<p>This looks as follows ‚Äì in this case we‚Äôre running the same LLM over different prompts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">burr.core</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">state</span>
<span class="kn">from</span> <span class="nn">burr.core.parallelism</span> <span class="kn">import</span> <span class="n">MapStates</span><span class="p">,</span> <span class="n">RunnableGraph</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">query_llm</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">llm_output</span><span class="o">=</span><span class="n">_query_my_llm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">]))</span>

<span class="k">class</span> <span class="nc">TestMultiplePrompts</span><span class="p">(</span><span class="n">MapStates</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Action</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">RunnableGraph</span><span class="p">:</span>
        <span class="c1"># make sure to add a name to the action</span>
        <span class="c1"># This is not necessary for subgraphs, as actions will already have names</span>
        <span class="k">return</span> <span class="n">query_llm</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;query_llm&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ApplicationContext</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="c1"># You could easily have a list_prompts upstream action that writes to &quot;prompts&quot; in state</span>
        <span class="c1"># And loop through those</span>
        <span class="c1"># This hardcodes for simplicity</span>
        <span class="k">for</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;What is the meaning of life?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;What is the airspeed velocity of an unladen swallow?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;What is the best way to cook a steak?&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">yield</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">states</span><span class="p">:</span> <span class="n">Generator</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
        <span class="n">all_llm_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sub_state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="n">all_llm_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">all_llm_outputs</span><span class="o">=</span><span class="n">all_llm_outputs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;prompts&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">writes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;all_llm_outputs&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Then, to run the application:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ApplicationBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_action</span><span class="p">(</span>
        <span class="n">prompt_generator</span><span class="o">=</span><span class="n">generate_prompts</span><span class="p">,</span> <span class="c1"># not defined above, this writes to prompts</span>
        <span class="n">multi_prompt_test</span><span class="o">=</span><span class="n">TestMultiplePrompts</span><span class="p">(),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">with_transitions</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;prompt_generator&quot;</span><span class="p">,</span> <span class="s2">&quot;multi_prompt_test&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="run-different-actions-over-the-same-state">
<h3>Run different actions over the same state<a class="headerlink" href="#run-different-actions-over-the-same-state" title="Link to this heading">¬∂</a></h3>
<p>For case (2) (mapping actions over the same state) you implement the <code class="docutils literal notranslate"><span class="pre">MapActions</span></code> class, doing the following:</p>
<ul class="simple">
<li><p>We define a regular action <code class="docutils literal notranslate"><span class="pre">query_llm()</span></code> using the <code class="docutils literal notranslate"><span class="pre">&#64;action</span></code> decorator. This takes in a model parameter (which we‚Äôre going to bind later)</p></li>
<li><dl class="simple">
<dt>We also create a subclass of <code class="docutils literal notranslate"><span class="pre">MapActions</span></code> named <code class="docutils literal notranslate"><span class="pre">TestMultipleModels</span></code>, which must implement <code class="docutils literal notranslate"><span class="pre">.reads()</span></code>, <code class="docutils literal notranslate"><span class="pre">.writes()</span></code>, <code class="docutils literal notranslate"><span class="pre">.actions()</span></code>, <code class="docutils literal notranslate"><span class="pre">.state()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.reduce()</span></code>.</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.reads()</span></code> / <code class="docutils literal notranslate"><span class="pre">.writes()</span></code> define the state value it can interact with, just like the <code class="docutils literal notranslate"><span class="pre">&#64;action</span></code> decorator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.actions()</span></code> leverages the <code class="docutils literal notranslate"><span class="pre">query_llm()</span></code> previously defined, binding with the different models we want to test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.state()</span></code> can read value from State and produces the state to pass to the actions produced by <code class="docutils literal notranslate"><span class="pre">actions()</span></code>. In this case, it updates the prompt state value that‚Äôs read by <code class="docutils literal notranslate"><span class="pre">query_llm()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.reduce()</span></code> receives multiple states, one per result of the <code class="docutils literal notranslate"><span class="pre">.actions()</span></code> call, where the llm_output value is set by <code class="docutils literal notranslate"><span class="pre">query_llm()</span></code> in <code class="docutils literal notranslate"><span class="pre">.actions()</span></code>. Then, it must set all_llm_output as specified in the <code class="docutils literal notranslate"><span class="pre">MapStates.writes()</span></code> method.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>We pass an instance of the <code class="docutils literal notranslate"><span class="pre">TestMultipleModels</span></code> class to the <code class="docutils literal notranslate"><span class="pre">ApplicationBuilder</span></code>, which will run the action over the states we provide.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">burr.core</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">state</span>
<span class="kn">from</span> <span class="nn">burr.core.parallelism</span> <span class="kn">import</span> <span class="n">MapActions</span><span class="p">,</span> <span class="n">RunnableGraph</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">query_llm</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="c1"># TODO -- implement _query_my_llm to call litellm or something</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">llm_output</span><span class="o">=</span><span class="n">_query_my_llm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">TestMultipleModels</span><span class="p">(</span><span class="n">MapActions</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ApplicationContext</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Action</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">RunnableGraph</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="c1"># Make sure to add a name to the action if you use bind() with a function,</span>
        <span class="c1"># note that these can be different actions, functions, etc...</span>
        <span class="c1"># in this case we&#39;re using `.bind()` to create multiple actions, but we can use some mix of</span>
        <span class="c1"># subgraphs, functions, action objects, etc...</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;gpt_4_answer&quot;</span><span class="p">),</span>
            <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;o1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;o1_answer&quot;</span><span class="p">),</span>
            <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;claude_answer&quot;</span><span class="p">),</span>
        <span class="p">]</span>
            <span class="k">yield</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;What is the meaning of life?&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">states</span><span class="p">:</span> <span class="n">Generator</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
        <span class="n">all_llm_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sub_state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="n">all_llm_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">all_llm_outputs</span><span class="o">=</span><span class="n">all_llm_outputs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">]</span> <span class="c1"># we&#39;re just running this on a single prompt, for multiple actions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">writes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;all_llm_outputs&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Then, it‚Äôs almost identical to the <code class="docutils literal notranslate"><span class="pre">MapStates</span></code> case:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ApplicationBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_action</span><span class="p">(</span>
        <span class="n">prompt_generator</span><span class="o">=</span><span class="n">generate_prompts</span><span class="p">,</span> <span class="c1"># not defined above, this writes to prompts</span>
        <span class="n">multi_prompt_test</span><span class="o">=</span><span class="n">TestMultipleModels</span><span class="p">(),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">with_transitions</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;prompt_generator&quot;</span><span class="p">,</span> <span class="s2">&quot;multi_prompt_test&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="full-cartesian-product">
<h3>Full cartesian product<a class="headerlink" href="#full-cartesian-product" title="Link to this heading">¬∂</a></h3>
<p>If you want to run all possible combinations of actions/states, you can use the <code class="docutils literal notranslate"><span class="pre">MapActionsAndStates</span></code> class  ‚Äì this is actually the
base class for the above two classes. For this, you provide a generator of actions and a generator of states, and Burr will run all possible
combinations.</p>
<p>For tracking which states/actions belong to which actions, we recommend you use the values stored in the state (see example).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">burr.core</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">state</span>
<span class="kn">from</span> <span class="nn">burr.core.parallelism</span> <span class="kn">import</span> <span class="n">MapActionsAndStates</span><span class="p">,</span> <span class="n">RunnableGraph</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">query_llm</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="c1"># TODO -- implement _query_my_llm to call litellm or something</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">llm_output</span><span class="o">=</span><span class="n">_query_my_llm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">TestModelsOverPrompts</span><span class="p">(</span><span class="n">MapActionsAndStates</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ApplicationContext</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Action</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">RunnableGraph</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="c1"># make sure to add a name to the action</span>
        <span class="c1"># This is not necessary for subgraphs, as actions will already have names</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;gpt_4_answer&quot;</span><span class="p">),</span>
            <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;o1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;o1_answer&quot;</span><span class="p">),</span>
            <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;claude_answer&quot;</span><span class="p">),</span>
        <span class="p">]</span>
            <span class="k">yield</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ApplicationContext</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;What is the meaning of life?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;What is the airspeed velocity of an unladen swallow?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;What is the best way to cook a steak?&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">yield</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">states</span><span class="p">:</span> <span class="n">Generator</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
        <span class="n">all_llm_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sub_state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="n">all_llm_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;output&quot;</span> <span class="p">:</span> <span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;model&quot;</span> <span class="p">:</span> <span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;prompt&quot;</span> <span class="p">:</span> <span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">all_llm_outputs</span><span class="o">=</span><span class="n">all_llm_outputs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;prompts&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">writes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;all_llm_outputs&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="subgraphs">
<h3>Subgraphs<a class="headerlink" href="#subgraphs" title="Link to this heading">¬∂</a></h3>
<p>While we‚Äôve been using individual actions above, we can also replace them with subgraphs (E.G. <a class="reference internal" href="../recursion/#recursion"><span class="std std-ref">using recursion</span></a>  inside applications).</p>
<p>To do this, we use the Graph API and wrap it in a RunnableGraph:</p>
<ul class="simple">
<li><p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> API allows us to tell the structure of the action</p></li>
<li><dl class="simple">
<dt>The <code class="docutils literal notranslate"><span class="pre">RunnableGraph</span></code> is a wrapper that tells the framework other things you need to know to run the graph:</dt><dd><ul>
<li><p>The entrypoint of the graph</p></li>
<li><p>The exit points (corresponding to <code class="docutils literal notranslate"><span class="pre">halt_after</span></code> in <code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code>)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>This might look as follows ‚Äì say we have a simple subflow that takes in a raw prompt from state and returns the LLM output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">burr.core</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">state</span>
<span class="kn">from</span> <span class="nn">burr.core.graph</span> <span class="kn">import</span> <span class="n">Graph</span>
<span class="kn">from</span> <span class="nn">burr.core.parallelism</span> <span class="kn">import</span> <span class="n">RunnableGraph</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;processed_prompt&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">process_prompt</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="n">processed_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The user has asked: </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;prompt&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Please respond directly to that prompt, but only in riddles.&quot;</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">processed_prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span>
    <span class="p">)</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;processed_prompt&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">query_llm</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">llm_output</span><span class="o">=</span><span class="n">_query_my_llm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;processed_prompt&quot;</span><span class="p">]))</span>

<span class="n">graph</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">GraphBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_action</span><span class="p">(</span>
        <span class="n">process_prompt</span><span class="o">=</span><span class="n">process_prompt</span><span class="p">,</span>
        <span class="n">query_llm</span><span class="o">=</span><span class="n">query</span>
    <span class="p">)</span><span class="o">.</span><span class="n">with_transitions</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;process_prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;query_llm&quot;</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">runnable_graph</span> <span class="o">=</span> <span class="n">RunnableGraph</span><span class="p">(</span>
    <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
    <span class="n">entrypoint</span><span class="o">=</span><span class="s2">&quot;process_prompt&quot;</span><span class="p">,</span>
    <span class="n">halt_after</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;query_llm&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">TestMultiplePromptsWithSubgraph</span><span class="p">(</span><span class="n">MapStates</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Action</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">RunnableGraph</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">runnable_graph</span>

    <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ApplicationContext</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;What is the meaning of life?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;What is the airspeed velocity of an unladen swallow?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;What is the best way to cook a steak?&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">yield</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>

    <span class="o">...</span> <span class="c1"># same as above</span>
</pre></div>
</div>
<p>In the code above, we‚Äôre effectively treating the graph like an action ‚Äì due to the single <code class="docutils literal notranslate"><span class="pre">entrypoint</span></code>/<code class="docutils literal notranslate"><span class="pre">halt_after</span></code> condition we specified,
it can run just as the single prompt we did above. Note this is also doable for running multiple actions over the same state.</p>
</section>
<section id="passing-inputs">
<h3>Passing inputs<a class="headerlink" href="#passing-inputs" title="Link to this heading">¬∂</a></h3>
<p>Parallel actions can accept inputs in the same way that class-based actions do. In order to accept inputs you have to declare them in the class. As we‚Äôre using the <a class="reference internal" href="../actions/#classbasedactions"><span class="std std-ref">class-based API</span></a>,
this is done by declaring the <code class="docutils literal notranslate"><span class="pre">inputs</span></code> property ‚Äì a list of strings that are used in inputs. Note you have to use the superclasses
inputs as well to ensure it has everything it needs ‚Äì we will likely be automating this.</p>
<p>This looks as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">burr.core</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="n">ApplicationContext</span>
<span class="kn">from</span> <span class="nn">burr.core.graph</span> <span class="kn">import</span> <span class="n">Graph</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;processed_prompt&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">process_prompt</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="n">processed_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The user has asked: </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;prompt&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Please respond directly to that prompt, but only in riddles.&quot;</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span>
    <span class="p">)</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;processed_prompt&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">query_llm</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">llm_output</span><span class="o">=</span><span class="n">_query_my_llm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;processed_prompt&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>

<span class="n">graph</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">GraphBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_action</span><span class="p">(</span>
        <span class="n">process_prompt</span><span class="o">=</span><span class="n">process_prompt</span><span class="p">,</span>
        <span class="n">query_llm</span><span class="o">=</span><span class="n">query</span>
    <span class="p">)</span><span class="o">.</span><span class="n">with_transitions</span><span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;process_prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;query_llm&quot;</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">runnable_graph</span> <span class="o">=</span> <span class="n">RunnableGraph</span><span class="p">(</span>
    <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
    <span class="n">entrypoint</span><span class="o">=</span><span class="s2">&quot;process_prompt&quot;</span><span class="p">,</span>
    <span class="n">halt_after</span><span class="o">=</span><span class="s2">&quot;query_llm&quot;</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">TestMultiplePromptsWithSubgraph</span><span class="p">(</span><span class="n">MapStates</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Action</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">RunnableGraph</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">runnable_graph</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;prompts&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">inputs</span> <span class="c1"># make sure to include the superclass inputs</span>

    <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ApplicationContext</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;prompts&quot;</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>

    <span class="o">...</span> <span class="c1"># same as above</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Should <code class="docutils literal notranslate"><span class="pre">MapOverInputs</span></code> be its own class? Or should we have <code class="docutils literal notranslate"><span class="pre">bind_from_state(prompt=&quot;prompt_field_in_state&quot;)</span></code> that allows you to pass it in as
state and just use the mapping capabilities? Or are we happy as it currently is because we can pass in inputs through <cite>MapStates</cite>/<cite>MapActions</cite> (as shown above).</p>
</div>
</section>
</section>
<section id="lower-level-api">
<h2>Lower-level API<a class="headerlink" href="#lower-level-api" title="Link to this heading">¬∂</a></h2>
<p>The above compile into a set of ‚Äútasks‚Äù ‚Äì sub-applications to run. If, however, you want to have more control, you
can use the lower-level API to simply define the tasks. This allows you to provide any combination of actions, input, and state
to the tasks.</p>
<p>All of the aforementioned high-level API are implemented as subclasses of TaskBasedParallelAction.
You can subclass it directly and implement the <code class="docutils literal notranslate"><span class="pre">.tasks()</span></code> method that yields SubGraphTask,
which can be actions or subgraphs. These tasks are then executed by the <code class="docutils literal notranslate"><span class="pre">burr.Executor</span></code> implementations</p>
<p>This looks as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">burr.core</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">ApplicationContext</span>
<span class="kn">from</span> <span class="nn">burr.core.parallelism</span> <span class="kn">import</span> <span class="n">MapStates</span><span class="p">,</span> <span class="n">RunnableGraph</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">writes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">query_llm</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
    <span class="c1"># TODO -- implement _query_my_llm to call litellm or something</span>
    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">llm_output</span><span class="o">=</span><span class="n">_query_my_llm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MultipleTaskExample</span><span class="p">(</span><span class="n">TaskBasedParallelAction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">tasks</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ApplicationContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">SubGraphTask</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;prompts&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;gpt_4_answer&quot;</span><span class="p">),</span>
                <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;o1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;o1_answer&quot;</span><span class="p">),</span>
                <span class="n">query_llm</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;claude_answer&quot;</span><span class="p">),</span>
            <span class="p">]</span>
                <span class="k">yield</span> <span class="n">SubGraphTask</span><span class="p">(</span>
                    <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="c1"># can be a RunnableGraph as well</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">),</span>
                    <span class="n">inputs</span><span class="o">=</span><span class="p">{},</span>
                    <span class="c1"># stable hash -- up to you to ensure uniqueness</span>
                    <span class="n">application_id</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">application_id</span> <span class="o">+</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span>
                    <span class="c1"># a few other parameters we might add -- see advanced usage -- failure conditions, etc...</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">states</span><span class="p">:</span> <span class="n">Generator</span><span class="p">[</span><span class="n">State</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">State</span><span class="p">:</span>
        <span class="n">all_llm_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sub_state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="n">all_llm_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;output&quot;</span> <span class="p">:</span> <span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;llm_output&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;model&quot;</span> <span class="p">:</span> <span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;prompt&quot;</span> <span class="p">:</span> <span class="n">sub_state</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">all_llm_outputs</span><span class="o">=</span><span class="n">all_llm_outputs</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading">¬∂</a></h2>
<p>We anticipate the above should cover most of what you want to do, but we have a host of advanced tuning capabilities.</p>
<section id="execution">
<h3>Execution<a class="headerlink" href="#execution" title="Link to this heading">¬∂</a></h3>
<p>To enable execution, you need to pass a <code class="docutils literal notranslate"><span class="pre">burr.Executor</span></code> to the application, or to the actions themselves. This is just a python executor
instance, although we will likely be adding a new interface.</p>
<p>You can implement your own by subclassing the <code class="docutils literal notranslate"><span class="pre">concurrent.futures.Executor</span></code> class and passing to your favorite execution tool.</p>
<p>This only makes sense for synchronous execution ‚Äì for async, it will use asyncio.gather. You can pass this either as a global executor for the application, or specify it as part of your class:</p>
<p>Specifying it as part of the application ‚Äì will get routed as the default to all parallel actions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ApplicationBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_parallel_executor</span><span class="p">(</span><span class="n">MultiThreadedExecutor</span><span class="p">(</span><span class="n">max_concurrency</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Specifying it as part of the action ‚Äì will override the global executor (note this is not supported yet‚Ä¶).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestMultiplePrompts</span><span class="p">(</span><span class="n">MapStates</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Action</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">RunnableGraph</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">runnable_graph</span>

    <span class="k">def</span> <span class="nf">executor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Executor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MultiThreadedExecutor</span><span class="p">(</span><span class="n">max_concurrency</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="o">...</span> <span class="c1"># same as above</span>
</pre></div>
</div>
</section>
<section id="persistence-tracking">
<h3>Persistence/Tracking<a class="headerlink" href="#persistence-tracking" title="Link to this heading">¬∂</a></h3>
<p>By default, the trackers/persisters will be passed from the parent application to the child application. The application IDs
will be created as a a stable hash of the parent ID + the index of the child ID, requiring the order to be constant to ensure that the same application ID is used for the same task every time.</p>
<p>Note that we will be adding hte ability to create a unique key, per application, but that is not implemented yet.</p>
<p>It will also utilize the same persister to load from the prior state, if that is used on the application level (see <a class="reference internal" href="../state-persistence/#id1"><span class="std std-ref">state persistence</span></a>).</p>
<p>This enables the following:</p>
<ol class="arabic simple">
<li><p>Tracking will automatically be associated with the same application (and sub-application) when reloaded</p></li>
<li><p>If the concurrent application quits halfway through, the application will be able to pick up where it left off, as will all sub-applications</p></li>
</ol>
<p>The default behavior is to cascade all the following constructs through to the parallel child applications:</p>
<ol class="arabic simple">
<li><p>Tracking (given by the <a class="reference internal" href="../../reference/application/#burr.core.application.ApplicationBuilder.with_tracker" title="burr.core.application.ApplicationBuilder.with_tracker"><code class="xref py py-meth docutils literal notranslate"><span class="pre">burr.core.application.ApplicationBuilder.with_tracker()</span></code></a> function in <a class="reference internal" href="../../reference/application/#burr.core.application.ApplicationBuilder" title="burr.core.application.ApplicationBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplicationBuilder</span></code></a>)</p></li>
<li><p>State saving/persistence (given by the <a class="reference internal" href="../../reference/application/#burr.core.application.ApplicationBuilder.with_state_persister" title="burr.core.application.ApplicationBuilder.with_state_persister"><code class="xref py py-meth docutils literal notranslate"><span class="pre">burr.core.application.ApplicationBuilder.with_state_persister()</span></code></a> function in <a class="reference internal" href="../../reference/application/#burr.core.application.ApplicationBuilder" title="burr.core.application.ApplicationBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">burr.core.application.ApplicationBuilder</span></code></a>)</p></li>
<li><p>State loading (given by the <a class="reference internal" href="../../reference/application/#burr.core.application.ApplicationBuilder.initialize_from" title="burr.core.application.ApplicationBuilder.initialize_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">burr.core.application.ApplicationBuilder.initialize_from()</span></code></a> function in <a class="reference internal" href="../../reference/application/#burr.core.application.ApplicationBuilder" title="burr.core.application.ApplicationBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">burr.core.application.ApplicationBuilder</span></code></a>)</p></li>
</ol>
<p>These will then be passed ot the corresponding sub-application tasks. If any of these objects implement a <cite>.copy()</cite> method, that will be called. Otherwise the same instance will be created. Not the tracker/persister/loader must be serializable
to work in non-multithreaded executors, and thread-safe to work in multithreaded instances.</p>
<p>In mst cases, (2) and (3) above will be the same, however there all valid use-cases where you might want to use different persisters/loaders for the sub-application.
Thus, the default will be to pass the same instance for (2) and (3), <em>if</em> they both exist and are specified.</p>
<p>You can disable either tracking or persistence at the sub-application level by overriding one of the three methods (corresponding to the three adapter-types above),
on any of the <code class="xref py py-class docutils literal notranslate"><span class="pre">burr.core.parallelism.MapStatesAndActions</span></code>, <a class="reference internal" href="../../reference/parallelism/#burr.core.parallelism.MapStates" title="burr.core.parallelism.MapStates"><code class="xref py py-class docutils literal notranslate"><span class="pre">burr.core.parallelism.MapStates</span></code></a>, or <a class="reference internal" href="../../reference/parallelism/#burr.core.parallelism.MapActions" title="burr.core.parallelism.MapActions"><code class="xref py py-class docutils literal notranslate"><span class="pre">burr.core.parallelism.MapActions</span></code></a> classes.</p>
<p>If you return <cite>None</cite>, then no tracker/persister will be used. If you return an object (E.G. a tracker or a persister), that will be used instead.
The function will be called for every instance of the sub-application.</p>
<ol class="arabic simple">
<li><p>Overriding the tracker <code class="xref py py-meth docutils literal notranslate"><span class="pre">burr.core.parallelism.MapStatesAndAction.tracker()</span></code></p></li>
<li><p>Overriding the persister <code class="xref py py-meth docutils literal notranslate"><span class="pre">burr.core.parallelism.MapStatesAndAction.state_persister()</span></code></p></li>
<li><p>Overriding the loader <code class="xref py py-meth docutils literal notranslate"><span class="pre">burr.core.parallelism.MapStatesAndAction.state_initializer()</span></code></p></li>
</ol>
<p>You can also set the corresponding fields in the <a class="reference internal" href="../../reference/parallelism/#burr.core.parallelism.SubGraphTask" title="burr.core.parallelism.SubGraphTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">burr.core.parallelism.SubGraphTask</span></code></a> object on a per-task basis,
if you are using the lower-level API.</p>
<p>You can also disable it globally using the application builder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestMultiplePrompts</span><span class="p">(</span><span class="n">MapStates</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Action</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">RunnableGraph</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">runnable_graph</span>

    <span class="k">def</span> <span class="nf">tracker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrackingBehavior</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># return &quot;cascade&quot; # default</span>
        <span class="c1"># return None # no tracking</span>
        <span class="k">return</span> <span class="n">LocalTrackingClient</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># custom tracker</span>

    <span class="k">def</span> <span class="nf">state_persister</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Persister</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># return &quot;cascade&quot; # default</span>
        <span class="c1"># return None # no persistence</span>
        <span class="k">return</span> <span class="n">SQLLitePersister</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># custom persister</span>

    <span class="k">def</span> <span class="nf">state_initializer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateInitializer</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_perssiter</span><span class="p">()</span> <span class="c1"># same as the persister</span>

    <span class="o">...</span> <span class="c1"># same as above</span>
</pre></div>
</div>
</section>
<section id="other">
<h3>Other<a class="headerlink" href="#other" title="Link to this heading">¬∂</a></h3>
<p>Things we will consider after the initial release:</p>
<ul class="simple">
<li><p>Customizing execution on a per-action basis ‚Äì likely a parameter to <code class="docutils literal notranslate"><span class="pre">RunnableGraph</span></code></p></li>
<li><p>Customizing tracking keys for parallelism</p></li>
<li><p>Streaming ‚Äì interleaving parallel streaming actions and giving results as they come</p></li>
<li><p>More examples for inter-graph communication/cancellation of one action based on the result of another</p></li>
<li><p>Graceful failure of sub-actions</p></li>
</ul>
</section>
</section>
<section id="under-the-hood">
<h2>Under the hood<a class="headerlink" href="#under-the-hood" title="Link to this heading">¬∂</a></h2>
<p>Beneath the APIs, all this does is simplify the <a class="reference internal" href="../recursion/#recursion"><span class="std std-ref">recursion</span></a>: API to allow for multiple actions to be run in parallel.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RunnableGraph</span></code> s are set as subgraphs, and recursively executed by the application, using the executor</p></li>
<li><p>an <code class="docutils literal notranslate"><span class="pre">Action</span></code> are turned into a <code class="docutils literal notranslate"><span class="pre">RunnableGraph</span></code> by the framework, and executed by the executor</p></li>
</ul>
<p>In the UI, this will show up as a ‚Äúchild‚Äù application ‚Äì see the <a class="reference internal" href="../recursion/#recursion"><span class="std std-ref">recursion</span></a>: section for more details.</p>
</section>
<section id="additional-use-cases">
<h2>Additional Use-cases<a class="headerlink" href="#additional-use-cases" title="Link to this heading">¬∂</a></h2>
<p>As this is all just syntactic sugar for recursion, you can use the recursion to get more advanced capabilities.</p>
<p>This involves instantiating a sub-application inside the action, and running it yourself.</p>
<section id="interleaving-generators">
<h3>Interleaving Generators<a class="headerlink" href="#interleaving-generators" title="Link to this heading">¬∂</a></h3>
<p>Say you want to provide an agent that provides up-to-date progress on it‚Äôs thoughts. For example, say you want to providea
a planning agent with a similar interface to OpenAI‚Äôs o1 model.</p>
<p>To do this, you would typically call to <a class="reference internal" href="../../reference/application/#burr.core.application.Application.iterate" title="burr.core.application.Application.iterate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterate</span></code></a>. Now, say you wanted to run
multiple in parallel!</p>
<p>While this is not built to be easy with the APIs in this section, it‚Äôs very doable with the underlying recursion API.</p>
<p>The basics (code not present now):</p>
<ol class="arabic simple">
<li><p>Create each sub-application using the <code class="docutils literal notranslate"><span class="pre">with_parent_context</span></code> method</p></li>
<li><p>Run each sub-application in parallel using the executor</p></li>
<li><p>Combine the generators in parallel, yielding results as they come out</p></li>
</ol>
</section>
<section id="inter-action-communication">
<h3>Inter-action communication<a class="headerlink" href="#inter-action-communication" title="Link to this heading">¬∂</a></h3>
<p>Say you have two LLMs answering the same question ‚Äì one that gives immediate results back to the user
as they come in, and another that thinks for a while to give more sophisticated results. The user then has the option to say they‚Äôre happy
with the solution, or they want to wait for more. You may want to eagerly kick off the second LLM
if you‚Äôre concerned about latency ‚Äì thus if the user wants more or does not respond, the more sophisticated
LLM might come up with a solution.</p>
<p>To do this, you would:</p>
<ol class="arabic simple">
<li><p>Run the sub-graph consisting of the first LLM using <a class="reference internal" href="../../reference/application/#burr.core.application.Application.iterate" title="burr.core.application.Application.iterate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterate</span></code></a></p></li>
<li><p>Simultaneously run the second LLM using <a class="reference internal" href="../../reference/application/#burr.core.application.Application.iterate" title="burr.core.application.Application.iterate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterate</span></code></a> as well</p></li>
<li><p>Join them in parallel, waiting for any user-input if provided</p></li>
<li><p>Decide after every step of the first graph whether you want to cancel the second graph or not ‚Äì E.G. is the user satisfied.</p></li>
</ol>
</section>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Link to this heading">¬∂</a></h2>
<p>This is in an experimental release phase. While we anticipate the API to be stable, we reserve the right to make slight changes (and will obviously add new features).</p>
<p>Things that may change:</p>
<ol class="arabic simple">
<li><p>We will likely alter the executor API to be more flexible, although we will probably allow for use of the current executor API</p></li>
<li><p>We will be adding guard-rails for generator-types (sync versus async)</p></li>
<li><p>The UI is a WIP ‚Äì we have more sophisticated capabilities but are still polishing them</p></li>
<li><p>Support for action-level executors</p></li>
</ol>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../recursion/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Recursive Applications</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../additional-visibility/">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Additional Visibility</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Elijah ben Izzy, Stefan Krawczyk
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Parallelism</a><ul>
<li><a class="reference internal" href="#tl-dr">TL;DR</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#higher-level-api">Higher-level API</a><ul>
<li><a class="reference internal" href="#run-the-same-action-over-different-states">Run the same action over different states</a></li>
<li><a class="reference internal" href="#run-different-actions-over-the-same-state">Run different actions over the same state</a></li>
<li><a class="reference internal" href="#full-cartesian-product">Full cartesian product</a></li>
<li><a class="reference internal" href="#subgraphs">Subgraphs</a></li>
<li><a class="reference internal" href="#passing-inputs">Passing inputs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lower-level-api">Lower-level API</a></li>
<li><a class="reference internal" href="#advanced-usage">Advanced Usage</a><ul>
<li><a class="reference internal" href="#execution">Execution</a></li>
<li><a class="reference internal" href="#persistence-tracking">Persistence/Tracking</a></li>
<li><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
<li><a class="reference internal" href="#under-the-hood">Under the hood</a></li>
<li><a class="reference internal" href="#additional-use-cases">Additional Use-cases</a><ul>
<li><a class="reference internal" href="#interleaving-generators">Interleaving Generators</a></li>
<li><a class="reference internal" href="#inter-action-communication">Inter-action communication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=187304be"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>